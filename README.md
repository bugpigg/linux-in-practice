# 리눅스 구조

["실습과 그림으로 배우는 리눅스 구조"](https://www.aladin.co.kr/shop/wproduct.aspx?ItemId=181554153) 책을 읽으며 실습을 진행해보자!

<details>
<summary>1장 컴퓨터 시스템의 개요</summary>

### 리눅스의 주요 역할
- OS가 없으면 여러개의 프로세스가 각자 디바이스를 조작하는 코드를 작성해야함
    - 개발 비용이 커짐
    - 모든 개발자가 디바이스 스펙을 알아야 함 
    - ✅ 리눅스에서는 디바이스 드라이버를 통해 각 프로세스가 디바이스에 접근
- 프로세스가 직접 하드웨어에 접근하는 것을 막아야 함
  - CPU에는 커널모드, 사용자 모드 존재
  - ✅ 커널모드 일때만 디바이스에 접근 가능
  - 또한 커널모드에서는?
    - 프로세스 관리, 스케줄링
    - 메모리 관리
  - OS는 커널 + 사용자 모드에서 동작하는 다양한 프로그램
- 프로세스 실행은 다양한 계층 구조를 구성하며 동작
- 저장 장치에 보관된 데이터는 디바이스 드라이버에 직접 요청해 접근 가능하지만, 보통 `파일 시스템`을 통해 편하게 접근

</details>

<details>
<summary>2장 사용자 모드로 구현되는 기능</summary>

### 시스템 콜
- 프로세스는 `프로세스 생성, 하드웨어 조작` 등이 필요한 경우 시스템 콜을 통해 커널에 처리 요청
- 종류
  - 프로세스 생성, 삭제
  - 메모리 확보, 해제
  - IPC
  - 네트워크
  - 파일 시스템 다루기
  - 파일 다루기

### CPU 모드 변경
- 시스템 콜 호출시 `인터럽트 이벤트` 발생

### 시스템 콜 호출의 동작 순서
- `strace` 명령어로 시스템 콜 확인해보기 - in C
  - `strace -o hello.log ./hello.exe`
  - 저장된 `hello.log` 확인해 보면 한줄 한줄이 시스템 콜이다
- 이번에는 python에서 확인해 보기
  - `strace -o hello.py python3 ./hello.py`
- 중요한 것은 어느 언어를 사용하든지 `write()` 시스템 콜이 호출된다는 것이다!

### 실험
- `sar` 명령어를 통해 사용자 모드와 커널 모드 중 어느쪽에서 실행중인지 확인 가능하다!!
- SAR(System Activity Reporter)
    ![image](https://user-images.githubusercontent.com/91416897/171203545-517c2b45-4420-410b-b807-4c1a5609ad95.png)
  - 사용자 모드는 -> %user 와 %nice 의 합계
  - 커널 모드는 -> %system 
- 실행하는 프로세스의 ID를 보고 싶다면?
  - `./실행 프로그램 &` 을 하면 PID를 출력해 준다!

### 시스템 콜의 소요시간
- `strace -T` 를 통해 각종 시스템 콜 처리에 걸린 시간을 마이크로 초 시간 단위로 정밀하게 측정 가능

### 시스템 콜의 wrapper 함수
- 시스템 콜은 C언어와 같은 고급언어에서는 직접 호출이 불가능
  - 그렇기에 만약 OS가 없었다면 해당 아키텍처의 어셈블리 코드를 통해 작성해야했을거임
- OS는 내부적으로 시스템 콜 wrapper 함수가 있어 알아서 시스템 콜을 작성

### 표준 C 라이브러리
- 보통 glibc 를 표준 C 라이브러리로 사용
- ldd(List Dynamic Dependencies)
  - 이 명령어를 통해 프로그램이 어떠한 라이브러리를 링크하고 있는가를 확인 가능-> 싱기하다...
  - 대부분 `libc` 라는 표준 C라이브러리를 링크한다
  - 파이썬도 해보면 `libc`를 링크한다.
    ![image](https://user-images.githubusercontent.com/91416897/171212323-b45e838b-75a0-44cf-86b3-3da1cba02b1c.png)

### POSIX 규격
- 유닉스 계열 OS가 갖추어야 할 각종 기능을 정해둔 규격

### OS가 제공하는 프로그램
- 시스템 초기화: init
- OS의 동작 바꾸기: sysctl, nice, sync
- 파일 관련: touch, mkdir
- 텍스트 데이터 가공: grep, sort, uniq
- 성능 측정: sar, iostat
- 컴파일러: gcc
- 스크립트 언어 실행 환경: python 등등
- 셸: bash
- 윈도우 시스템: X

</details>

